# Item 43

# 람다보다는 메서드 참조를 사용하라

### 람다와 메서드 참조

람다가 익명 클래스보다 나은 가장 큰 이유는 간결함이다. 그러나 람다보다 더 간결한 방법이 있는데 바로 **메서드 참조**다. 다음의 코드는 임의의 키와 Integer 값의 매핑을 관리하는 프로그램의 일부이다.

```java
map.merge(key, 1, (count, incr) -> count + incr);
```

이 코드는 키가 맵안에 없다면 키와 숫자 1을 매핑하고, 이미 있다면 기존 매핑 값을 증가시킨다. 이 때 값이 키의 인스턴스 개수로 해석된다면, 이 프로그램은 멀티셋을 구현한게 된다.(key 중복 저장)

위의 코드는 자바 8에 map에 추가된 merge 메서드를 사용했다. merge 메서드는 {키, 값, 함수}를 인자로 받으며, 주어진 키가 맵 안에 아직 없다면 주어진 {키, 값} 쌍을 그대로 저장한다. 반대로 키가 이미 존재한다면 {키, 현재값에 (세 번째 인자로 받은)함수를 적용한 값}을 덮어쓴다.

위의 코드에는 아직도 거추장스러운 부분이 남아있다.

```java
map.merge(key, 1, Integer::sum);
```

매개변수인 count와 incr은 크게 하는 일이 없이 공간을 차지하기 때문에 위의 코드와 같이 Integer 클래스의 sum 메서드의 참조를 전달하는 방법을 통해 더 간결하게 작성이 가능하다.

예외적으로 어떤 람다에서는 매개변수의 이름 자체가 프로그래머에게 좋은 가이드가 되기도 한다. 이런 람다는 길이는 더 길지만 메서드 참조보다 읽기 쉽고 유지보수도 쉬울 수 있다.

람다로 할 수 없는 일이라면 메서드 참조로도 할 수 없다.

단 **제네릭 함수 타입**을 구현할 때는 람다 사용이 불가능 하고 오직 메서드 참조만 사용가능하다.

```java
interface G1 {
   <E extends Exception> Object m() throws E;
}

interface G2 {
   <F extends Exception> String m() throws Exception;
}

interface G extends G1, G2 {}
```

이처럼 함수형 인터페이스를 위한 제네릭 함수 타입은 메서드 참조 표현식으로 구현할 수 있지만, 제네릭 람다식이라는 문법이 존재하지 않기 때문에 람다식으로는 불가능하다.

그렇더라도 메서드 참조를 사용하는 편이 보통은 더 짧고 간결하므로, 람다로 구현했을 때 너무 길거나 복잡하다면 메서드 참조를 사용하자. 람다로 작성할 코드를 새로운 매서드에 담은 다음, 람다 대신 그 메서드 참조를 사용하는 식이다. 매서드 참조에는 기능을 잘 드러내는 이름을 지어줄 수 있고 친절한 설명을 문서로 남길 수도 있다.

그러나 때로는 람다가 더 간결할 때가 있을 수도 있다. 주로 메서드와 람다가 같은 클래스에 있을 때 그렇다. 다음의 예를 살펴보자

```java
service.execute(GoshThisClassNameIsHumongous::action);
```

위의 코드가 GoshThisClassNameIsHumongous 클래스 안에 있을 경우 람다로 대체하면 다음과 같이 더 간결하게 작성이 가능하다.

```java
service.execute(() -> action());
```

### 메서드 참조 유형

1. 정적 메서드를 가리키는 메서드 참조
    - 앞서 살펴본 Integer클래스의 sum과 같이 정적 메서드를 가리키는 메서드 참조이다.
2. 인스턴스 메서드를 참조하는 유형
    1. 수신 객체를 특정하는 한정적 인스턴스 메서드 참조
        
        함수 객체를 적용하는 시점에 수신 객체를 알려준다. 이를 위해 수신 객체 전달용 매개변수가 매개변수 목록의 첫 번째로 추가되며, 그 뒤로는 참조되는 메서드 선언에 정의된 매개변수들이 온다.
        
    2. 수신 객체를 특정하지 않는 비한정적 인스턴스 메서드 참조
        
        스트림 파이프라인에서의 매핑과 필터 함수에 쓰인다.
        
3. 클래스 생성자를 가리키는 메서드 참조
4. 배열 생성자를 가리키는 메서드 참조

| No | 메서드 참조 유형 | 예 | 같은 기능을 하는 람다 |
| --- | --- | --- | --- |
| 1 | 정적 메서드를 가리키는 메서드 참조 | Integer::parseInt | str -> Integer.parseInt(str) |
| 2 | 인스턴스 메서드를 참조하는 유형 
 수신 객체를 특정하는 한정적 인스턴스 메서드 참조 | Instant.now()::isAfter | Instant then = Instant.now(); 
 t -> then.isAfter(t) |
| 3 | 인스턴스 메서드를 참조하는 유형 
 수신 객체를 특정하지 않는 비한정적 인스턴스 메서드 참조 | String::toLowerCase | str -> str.toLowerCase() |
| 4 | 클래스 생성자를 가리키는 메서드 레퍼런스 | TreeMap::new | () -> new TreeMap() |
| 5 | 배열 생성자를 가리키는 메서드 레퍼런스 | int[]::new | len -> new int[len] |